<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link rel="stylesheet" type="text/css" href="https://mikaelmayer.github.io/ProgrammingWithoutRegret/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://mikaelmayer.github.io/ProgrammingWithoutRegret/bootstrap/css/bootstrap-theme.min.css">
  <style id="booleanswitch">
  /* The switch - the box around the slider */
.switch {
  position: relative;
  display: inline-block;
  width: 30px;
  height: 17px;
  vertical-align: middle;
}

/* Hide default HTML checkbox */
.switch input {display:none;}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 13px;
  width: 13px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #2196F3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(13px);
  -ms-transform: translateX(13px);
  transform: translateX(13px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 17px;
}

.slider.round:before {
  border-radius: 50%;
}

.switch + label {
  cursor: pointer;
  padding-top: 5px;
  padding-bottom: 5px;
}
</style>
</head>
<body class="col-md-8 col-md-offset-2"><div original-tag-name="LLL" class="escapemain" original-field-order="0,1,-1,2"><style original-tag-name="LLLLL" original-field-order="0,-1,-1,1">
div.escapemain {
  text-align: center;
  margin-left: auto;
  margin-right: auto;
}
div#outputhtml {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
span.announcement {
  color: red;
  font-weight: bold;
}
span.digit {
  cursor:pointer;
  font-size: 30vh;
  margin-top: 20px;
}
span.digit:hover {
  background-color: #BBB;
}
span.weapon {
  cursor: pointer;
  display: inline-block;
  padding: 2px;
  margin: 2px;
  border: 1px solid black;
}
span.weapon:hover {
  background-color: #CCF;
}
span.weapon.selected {
  background-color: #CCC;
}
span.weapon.selected:hover {
  background-color: #CCC;
  cursor: default;
}
.footer {
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    background-color: #F88;
    color: black;
    text-align: center;
}
</style><h1 original-tag-name="LL" data-reverse-map="" data-original-html="Escape Year" original-field-order="0,-1,-1,1">Escape Year</h1><span data-string="true" data-reverse-map="" data-original-html="To reach 2018, choose your weapon and click on the digits:">To reach 2018, choose your weapon and click on the digits:</span><br original-tag-name="LL" original-field-order="0,-1,-1,-1"><span original-field-order="0,-1,-1,1" data-array="true"><span original-field-order="0,-1,-1,1" data-array="true"><span original-tag-name="LLLL" class="weapon selected" onclick="document.getElementById('weaponclicked').setAttribute('nth','0')" original-field-order="0,1,-1,2">Heat diffusion</span><span original-field-order="0,-1,-1,1" data-array="true"></span></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span><span original-field-order="0,-1,-1,1" data-array="true"></span></span><span original-tag-name="LLLL" id="clicked" nth="4" style="display: none;" original-field-order="0,1,2,-1"></span><span original-tag-name="LLLL" id="weaponclicked" nth="0" style="display: none;" original-field-order="0,1,2,-1"></span><br original-tag-name="LL" original-field-order="0,-1,-1,-1"><span original-field-order="0,-1,-1,1" data-array="true"><span original-tag-name="LLLL" class="digit" onclick="document.getElementById('clicked').setAttribute('nth', '0')" contenteditable="false" original-field-order="0,1,-1,2">2</span><span original-tag-name="LLLL" class="digit" onclick="document.getElementById('clicked').setAttribute('nth', '1')" contenteditable="false" original-field-order="0,1,-1,2">0</span><span original-tag-name="LLLL" class="digit" onclick="document.getElementById('clicked').setAttribute('nth', '2')" contenteditable="false" original-field-order="0,1,-1,2">1</span><span original-tag-name="LLLL" class="digit" onclick="document.getElementById('clicked').setAttribute('nth', '3')" contenteditable="false" original-field-order="0,1,-1,2">7</span></span><span original-field-order="0,-1,-1,1" data-array="true"></span><div original-tag-name="LLL" class="footer" original-field-order="0,1,-1,2"><span data-string="true" data-reverse-map="" data-original-html="Language:">Language:</span><select original-tag-name="LLLLLL" selected-index="1" onchange="this.setAttribute('selected-index', this.selectedIndex)" original-field-order="0,1,-1,2"><option original-tag-name="LLLLLL" value="0" data-reverse-map="" data-original-html="français" original-field-order="0,1,-1,2">français</option><option original-tag-name="LLLLLL" value="1" selected="selected" data-reverse-map="" data-original-html="English" original-field-order="0,1,-1,2">English</option></select><input original-tag-name="LLLLL" type="button" value="Start over" trigger="" onclick="this.setAttribute('trigger', '#')" original-field-order="0,1,-1,-1"></div></div><script src="https://mikaelmayer.github.io/ProgrammingWithoutRegret/lambda-perfect-opt.js?reload=1514772909985"></script><script>
 var programRaw = "// updatedelay: 0\n// output: html\n// download: EscapeYear2017.html\nimport {\n  d = [2,0,1,7],\n  special = [\"\",\"\",\"\",\"\"],\n  indexLang = 1,\n option = {apply=\\value,selected,content. {tag= \"option\", attributes={value=value} & (if(selected) {selected=\"selected\"} else {}), children=content},\nunapply=\\t. (t match {\n  case {attributes={value=value,selected=_}, children=content} => {value = [value, true, content] }\n  case {attributes={value=value},children=content} =>\n   {value = [value, false, content] }\n  case _ => {}\n}) },\n  map=\\f. \n  letrec aux acc l = l match {\n    case [] => acc\n    case [head]++tail => aux (acc ++ [f head]) tail\n  } in aux [],\n  mapWithIndex=\\f.\n  letrec aux i acc l = l match {\n    case [] => acc\n    case [head]++tail => aux (i + 1) (acc ++ [f [head,i]]) tail\n  } in aux 0 [],\n  modify = \\defaultContent.\\trigger.\\f. { apply = \\i. defaultContent,\n    update = \\p. if(p.outputNew == trigger) {value = f p.input} else {value = p.input}\n    },\n  updateArray = \\array.\\index.\\element.\n  [if(index == 0) element else array 0,\n   if(index == 1) element else array 1,\n   if(index == 2) element else array 2,\n   if(index == 3) element else array 3],\n  indexWhere = \\predicate.\\endIndex.\\array.\n    letrec aux index =\n      if(index == endIndex)\"error: predicate not satisfied\" else\n      if(predicate (array index)) index else\n      aux ((index + 1) % 4) in\n    aux ((endIndex + 1) % 4),\n  max = \\x.\\y. if(x > y) x else y,\n  min = \\x.\\y. if(x < y) x else y,\n  prev = [3, 0, 1, 2],\n  next = [1, 2, 3, 0]\n}._\nlet select array = {\n  apply=\\index.\n   letrec aux acc i options = options match {\n     case [] => acc\n     case [opt] ++ tail =>\n       let newAcc = acc ++ [option [i + \"\", i == index, opt]] in\n       let newI = i + 1 in\n       aux newAcc newI tail\n   } in\n  {tag=\"select\", attributes={`selected-index`=index + \"\", onchange=\"this.setAttribute('selected-index', this.selectedIndex)\"}, children= aux [] 0 array}\n} in\nlet button name controller model = \n  {tag=\"input\", attributes={type=\"button\", value=name, trigger=modify \"\" \"#\" controller model, onclick = \"this.setAttribute('trigger', '#')\"}} in\nlet translations = {\n  français = {\n    language = \"Langue :\",\n    restart = \"Recommencer\",\n    shareon = \"Partager ces vœux sur \",\n    welcomechooseweapon = \"Pour atteindre 2018, choisis ton arme et clique sur les chiffres:\",\n    wishes = \"Bonne année 2018 !!!\",\n    citation = \"Saluons ensemble cette nouvelle année qui vieillit notre amitié sans vieillir notre coeur.\",\n    newweapon = \"← nouvelle arme disponible : \",\n    thelast = \" et c'est la dernière !\"\n  },\n  English = {\n    language = \"Language:\",\n    restart = \"Start over\",\n    shareon = \"Share these wishes on \",\n    welcomechooseweapon = \"To reach 2018, choose your weapon and click on the digits:\",\n    wishes = \"Happy New Year 2018 !!!\",\n    citation = \"Let's greet together this new year that is aging our friendship without aging our hearts.\",\n    newweapon = \"← new weapon available: \",\n    thelast = \" and that's the last one !\"\n  }\n} in\nlet languages = keysOf translations in\nlet language = languages indexLang in\nlet tr = translations language in\nlet [currentEffect, nbClicks, currentMessage, htmlWin] = [0, 0, \"\",\n  [{tag=\"span\", children=``<h1>@tr.wishes</h1>\n  <i>@tr.citation</i><br> - Victor Hugo<br><br>\n  \n@tr.shareon <a href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmikaelmayer.github.io%2FEscapeYear2017.html\" target=\"_blank\" contentEditable=\"false\">\n  Facebook\n  </a> <a\n  href=\"https://twitter.com/intent/tweet?text=Escape%20Year%202017%20https%3A%2F%2Fmikaelmayer.github.io%2FEscapeYear2017.html%20Happy%20New%20Year%202018%20!\" contentEditable=\"false\">Twitter</a>\n  \n  <a href=\"mailto:?subject=Escape Year 2017&amp;body=Escape%20Year%202017%20https%3A%2F%2Fmikaelmayer.github.io%2FEscapeYear2017.html%20Happy%20New%20Year%202018%20!\"\n   title=\"Share by Email\" contentEditable=\"false\">\n  email</a>\n  ``}]] in\nlet effects = [\n { name={français=\"Diffusion de chaleur\", English=\"Heat diffusion\"},\n   icon=\"pointer\",\n   effect = \\nth. \n     let left = d (max (nth - 1) 0) in\n     let center = d nth in\n     let right = d (min (nth + 1) 3) in\n     let newCenter = center + (if(center >= left + 2) -1 else 0) + (if(center >= right + 2) -1 else 0) in\n     let newLeft = left + (if(center >= left + 2) 1 else 0) in\n     let newRight = right + (if(center >= right + 2) 1 else 0) in\n     [nth match { case 0 => newCenter case 1 => newLeft case _ => d 0 },\n      nth match { case 0 => newRight case 1 => newCenter case 2 => newLeft case _ => d 1 },\n      nth match { case 1 => newRight case 2 => newCenter case 3 => newLeft case _ => d 2 },\n      nth match { case 2 => newRight case 3 => newCenter case _ => d 3 }]\n  },\n  { name=\\x. \"Antoine Lavoisier\",\n    icon=\"copy\",\n    effect = \\nth. \n     let center = d nth in\n     if(center == 9) d else\n       if(d 0 + d 1 + d 2 + d 3 == center) d else // Pick the first non-empty decrease it.\n       let i = indexWhere (\\e. e > 0) nth d in\n       let dp = updateArray d i (d i - 1) in\n       let d2 = updateArray dp nth (center + 1) in\n       d2\n  },\n  { name={français=\"Immigrants\", English=\"Migrants\"},\n    icon=\"alias\",\n    effect = \\nth.\n      if(nth <= 1) [d 1, d 0, d 2, d 3] else [d 0, d 1, d 3, d 2]\n  },\n  { name={français=\"Tri sélectif\", English=\"Selective sorting\"},\n    icon=\"e-resize\",\n    effect = \\nth.\n      let n = next nth in\n      let current = d nth in\n      let next = d n in\n      if(current > next) updateArray (updateArray d nth next) n current else d\n  },\n  { name={français=\"Réchauffement climatique\", English=\"Global warming\"},\n    icon=\"n-resize\",\n    effect = \\nth.\n      [min (d 0 + 1) 9,\n       min (d 1 + 1) 9,\n       min (d 2 + 1) 9,\n       min (d 3 + 1) 9]\n  },\n  { name={français=\"La terre est ronde\", English=\"The Earth is round\"},\n    icon=\"e-resize\",\n    effect = \\nth.\n      [d 3, d 0, d 1, d 2]\n  },\n  { name={français=\"La terre est plate\", English=\"The Earth is flat\"},\n    icon=\"e-resize\",\n    effect = \\nth.\n      [0, d 0, d 1, d 2]\n  },\n  { name=\\x.\"Donald\",\n    icon=\"e-resize\",\n    effect = \\nth.\n      if(nth == 0) [2, d 1, d 2, if(d 1 == 0 && d 2 == 1 && d 3 == 8) 7 else d 3]\n      else if(nth == 1) [d 0, 0, d 2, if(d 0 == 2 && d 2 == 1 && d 3 == 8) 7 else d 3]\n      else if(nth == 2) [d 0, d 1, 1, if(d 0 == 2 && d 1 == 0 && d 3 == 8) 7 else d 3]\n      else [d 0, d 1, d 2, 7]\n  },\n  { name={français=\"Première guerre Mondiale\", English=\"World War I\"},\n    icon=\"e-resize\",\n    effect = \\nth. if(d 3 == 4) [1, 9, 1, 8] else [1, 9, 1, 4]\n  },\n  { name={français=\"Deuxième guerre Mondiale\", English=\"World War II\"},\n    icon=\"e-resize\",\n    effect = \\nth. if(d 3 == 9) [1, 9, 4, 5] else [1, 9, 3, 9]\n  },\n  { name={français=\"+1 / J'aime\", English=\"+1 / Like\"},\n    icon=\"copy\",\n    effect = \\nth. d,\n    effectSpecial = \\nth. special nth match {\n      case \"\" => updateArray special nth \"❤\"\n      case _ => updateArray special nth \"\"\n    }\n  },\n  { name={français=\"terrorisme\", English=\"Terrorism\"},\n    icon=\"copy\",\n    effect = \\nth. \n      let current = d nth in\n      let x = log \"current\" current in\n      let newCurrent = max 0 (d nth - 2) in\n      let uy = log \"newCurrent\" newCurrent in\n      let remainingToRemove = 4 - (current - newCurrent) in\n      let rt = log \"remainingToREmove\" remainingToRemove in\n      letrec explode d toRemove left center right = \n        let ddd = log \"explode\" [d, toRemove, left, center, right] in\n        if(toRemove == 0) d else\n        if(toRemove % 2 == 1 && right != center)\n          let removed = min 1 (d right) in\n          explode (updateArray d right (d right - removed )) (toRemove - removed) left center (if(removed ==0) next right else right)\n        else if(left != center || (left == center && d center > 0))\n          let removed = min 1 (d left) in\n          explode (updateArray d left (d left - removed )) (toRemove - removed) (if(removed==0) prev left else left) center right\n        else d\n      in\n      let init_d = (updateArray d nth (max 0 (current - 2))) in\n      let mm = log \"init_d\" init_d in\n      let init_left = prev nth in\n      let init_right = next nth in\n      explode init_d remainingToRemove init_left nth init_right\n  },\n  { name={français=\"Victor Hugo\", English=\"Victor Hugo\"},\n    icon=\"pointer\",\n    effect = \\nth. [1, 8, 0, 2]\n  }\n] in\nlet displayDigit nth = {\n  tag=\"span\", attributes={\n    class=\"digit\",\n    onclick=\"document.getElementById('clicked').setAttribute('nth', '\" + nth + \"')\"\n, contenteditable = \"false\"\n},\n  children=[{tag=\"#text\", value = if(special nth != \"\") special nth else (d nth + !\"\")}]} in\nlet selectedEffect =  effects currentEffect in\nlet finiehed = d 0 == 2 && d 1 == 0 && d 2 == 1 && d 3 == 8 in\n{tag=\"div\", attributes={class=\"escapemain\"}, children=[{tag=\"style\",children=[{tag=\"#text\", value=``\ndiv.escapemain {\n  text-align: center;\n  margin-left: auto;\n  margin-right: auto;\n}\ndiv#outputhtml {\n  display: block;\n  margin-left: auto;\n  margin-right: auto;\n}\nspan.announcement {\n  color: red;\n  font-weight: bold;\n}\nspan.digit {\n  cursor:@(selectedEffect match { case { icon = i } => i case _ => \"pointer\"});\n  font-size: 30vh;\n  margin-top: 20px;\n}\nspan.digit:hover {\n  background-color: #BBB;\n}\nspan.weapon {\n  cursor: pointer;\n  display: inline-block;\n  padding: 2px;\n  margin: 2px;\n  border: 1px solid black;\n}\nspan.weapon:hover {\n  background-color: #CCF;\n}\nspan.weapon.selected {\n  background-color: #CCC;\n}\nspan.weapon.selected:hover {\n  background-color: #CCC;\n  cursor: default;\n}\n.footer {\n    position: fixed;\n    left: 0;\n    bottom: 0;\n    width: 100%;\n    background-color: #F88;\n    color: black;\n    text-align: center;\n}\n``}]},\n{tag=\"h1\", children=\"Escape Year\"},\ntr.welcomechooseweapon, {tag=\"br\"},\nmapWithIndex (\\x,i. if(i*4 <= nbClicks ) [{ tag=\"span\", attributes={class=\"weapon\" + (if(i == currentEffect) \" selected\" else \"\"),\nonclick = ``document.getElementById('weaponclicked').setAttribute('nth','@i')``}, children=[{tag=\"#text\", value=x.name language}]}, if(i*4 == nbClicks && nbClicks > 0) [{tag=\"span\", attributes={class=\"announcement\"}, children=[{tag=\"#text\", value = tr.newweapon + x.name language + (if(x.name language == \"Victor Hugo\") tr.thelast else \"\")}]}] else []] else []) effects,\n/*select (map (\\x. x.name language) effects) currentEffect,*/\n{tag=\"span\", attributes={id=\"clicked\", nth = ({apply=\\x.!4 ,\n  update= \\p. {value = if(p.outputNew == 4) p.input else [selectedEffect.effect p.outputNew, selectedEffect match { case {effectSpecial = f} => f p.outputNew case _ => special}, nbClicks + 1]\n}}) [d, special, nbClicks] + !\"\"}, styles={display=\"none\"}},\n{tag=\"span\", attributes={id=\"weaponclicked\", nth = currentEffect + !\"\"}, styles={display=\"none\"}},\n{tag=\"br\"},\nif(finiehed) [] else [\ndisplayDigit 0, displayDigit 1, displayDigit 2, displayDigit 3], if(finiehed) htmlWin else [],\n{tag=\"div\", attributes={class=\"footer\"}, children=[\ntr.language, select languages indexLang, button tr.restart (\\d.[2,0,1,7]) d]}\n]}\n"
 var program = LambdaPerfect.parse(programRaw)
var value = LambdaPerfect.eval(program)
var node = LambdaPerfect.toHTML(value)
var lastSelection = null
setTimeout(function() {
  document.body.removeChild(document.body.lastChild); // Remove this script !
  document.body.removeChild(document.body.lastChild); // Remove last script !
}, 10);
var updateWithNode = function(prog2, value2, node2) {
  if(node2 != null) {
    while (document.body.firstChild) {
      document.body.removeChild(document.body.firstChild);
    }
    program = prog2
    value = value2
    document.body.appendChild(node2)
    if(lastSelection != null) {
      LambdaPerfect.putCaretPositionBack(document.body, lastSelection)
    }
  }
}
LambdaPerfect.watch(document.body, function() {
  lastSelection = LambdaPerfect.getCaretPositionIn(document.body);
  var n = document.body.firstChild
  var newValue = LambdaPerfect.fromHTML(n)
  if(LambdaPerfect.needsUpdate(value, newValue)) {
    var prog2 = LambdaPerfect.update(program, newValue)
    if(prog2 != null) {
      var value2 = LambdaPerfect.eval(prog2)
      if(value2 != null) {
        var node2 = LambdaPerfect.toHTML(value2)
        updateWithNode(prog2, value2, node2)
      } else {
        var nodeOrig = LambdaPerfect.toHTML(value)
        updateWithNode(program, value, nodeOrig)
      }
    } else { // No update found. We abort update and recompute the page.
      var nodeOrig = LambdaPerfect.toHTML(value)
      updateWithNode(program, value, nodeOrig)
    }
  }
}, 0)
document.body.setAttribute("contentEditable", "true")
               
</script></body></html>