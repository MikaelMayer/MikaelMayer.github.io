<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type">
<link rel="stylesheet" type="text/css" href="index.css">
<style>
.step > button {
  min-height: 48px;
  font-size: 0.5rem;
}
div.step:not(.second) button.previous:not([ghost-active=true]), div.step button.previous[ghost-active=false] {
  opacity: 0.5;
  cursor: inherit;
}
button.next[ghost-active=false] {
  opacity: 0.5;
  cursor: inherit;
}
button.final[ghost-active=false] {
  opacity: 0.5;
  cursor: inherit;
}
div.step > div[code] {
  display: none;
}
div.step:not(.second) > div[code]:not([ghost-active=false]):first-of-type {
  display: block;
}
div.step.second > div[code]:not([ghost-active=false]):nth-of-type(2) {
  display: block;
}

div.step > div[code][ghost-active=true] {
  display: block;
}
div.step > div[code][ghost-active=false] {
  display: none;
}
@media (orientation: landscape) {
  body > div {
    margin-left: auto;
    margin-right: auto;
    max-width: 32em;
  }
}
@media (orientation: portrait) {
  body > div {
    margin-left: 5px;
    margin-right: 5px;
  }
}
div[code] { 
  font-size: inherit !important;
  margin-top: 5px;
  margin-bottom: 5px;
}
</style>
</head><body><div class="menu">
  <a href="index.html">Back to index</a>
</div><div>

<h1>The essence of functional programming</h1>
<em>2019/02/08 — Mikaël Mayer</em>.<br>
<i>This article requires readers to be familiar with the notion of functional programming. It is written in Haskell. If you prefer Elm, you can also <a href="2019-02-08-essence-of-functional-programming.html">read the Elm version of the article</a>.</i>
<br><br>
Programming is an art. There are many ways to achieve the same purpose. In this article, I will informally review some of the common idioms when it comes to chaining operations on data.
<br><br>
Let us look at the following function in Javascript. It converts the input using three converters: <code>convert</code> might return <code>null</code>, <code>convert2</code> always succeeds, and <code>convert3</code> might return null. <code>convertData</code> returns either an error or a result:

<div language="javascript" code="var convertData = (input) => {&#10;  var intermediate = convert(input);&#10;  if(intermediate === null)&#10;    return {ctor: &quot;Left&quot;, _0: &quot;problem 1&quot;};&#10;  var intermediate2 = convert2(intermediate);&#10;  intermediate3 = convert3(intermediate2);&#10;  if(intermediate3 === null)&#10;    return {ctor: &quot;Left&quot;, _0: &quot;problem 2&quot;};&#10;  return {ctor: &quot;Right&quot;, _0: intermediate3};&#10;};" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div>

<h2>From imperative to pattern matching</h2>
To rewrite <code>convertData</code> to a functional language, such as Haskell, we first assume the following type definitions for the functions <code>convert</code>, <code>convert2</code> and <code>convert3</code>:

<div language="haskell" code="convert :: a -> Maybe b&#10;convert2 :: b -> c&#10;convert3 :: c -> Maybe d" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div>
Now we can rewrite <code>convertData</code> using pattern matching:
<div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  case convert input of&#10;    Nothing ->&#10;      Left &quot;problem 1&quot;&#10;&#10;    Just intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      case convert3 intermediate2 of&#10;        Nothing ->&#10;          Left &quot;problem 2&quot;&#10;&#10;        Just intermediate3 ->&#10;          Right intermediate3" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div>

<h2>From pattern matching to monadic style</h2>
However, besides type-checking, pattern matching does not provide that much benefit. For example, we still have intermediate names.
To avoid intermediate names, we can re-write our function in a monadic style (press Next> to view the refactoring step by step):
<div class="step second"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  case convert input of&#10;    Nothing ->&#10;      Left &quot;problem 1&quot;&#10;&#10;    Just intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      case convert3 intermediate2 of&#10;        Nothing ->&#10;          Left &quot;problem 2&quot;&#10;&#10;        Just intermediate3 ->&#10;          Right intermediate3" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> fmap (\intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      case convert3 intermediate2 of&#10;        Nothing ->&#10;          Left &quot;problem 2&quot;&#10;&#10;        Just intermediate3 ->&#10;          Right intermediate3&#10;    )&#10;  |> fromMaybe (Left &quot;problem 1&quot;)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> fmap convert2&#10;  |> fmap (\intermediate2 ->&#10;      case convert3 intermediate2 of&#10;        Nothing ->&#10;          Left &quot;problem 2&quot;&#10;&#10;        Just intermediate3 ->&#10;          Right intermediate3&#10;    )&#10;  |> fromMaybe (Left &quot;problem 1&quot;)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> fmap convert2&#10;  |> fmap (\intermediate2 ->&#10;      convert3 intermediate2&#10;      |> fmap (\intermediate3 ->&#10;        Right intermediate3)&#10;      |> fromMaybe (Left &quot;problem 2&quot;)&#10;    )&#10;  |> fromMaybe (Left &quot;problem 1&quot;)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> fmap convert2&#10;  |> fmap (&#10;      convert3&#10;      .> fmap (\intermediate3 ->&#10;        Right intermediate3)&#10;      .> fromMaybe (Left &quot;problem 2&quot;)&#10;    )&#10;  |> fromMaybe (Left &quot;problem 1&quot;)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> fmap convert2&#10;  |> fmap (&#10;      convert3&#10;      .> fmap Right&#10;      .> fromMaybe (Left &quot;problem 2&quot;)&#10;    )&#10;  |> fromMaybe (Left &quot;problem 1&quot;)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  convert&#10;  .> fmap convert2&#10;  .> fmap (&#10;      convert3&#10;      .> fmap Right&#10;      .> fromMaybe (Left &quot;problem 2&quot;)&#10;    )&#10;  .> fromMaybe (Left &quot;problem 1&quot;)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>
The operator <code>|></code> passes the computation to its left as the last argument of the expression to the right, and the operator <code>.></code> composes functions such that the function on its left is executed first<span> (assuming the <a href="http://hackage.haskell.org/package/flow-1.0.17/docs/Flow.html">Flow operators for forward composition)</a></span>.<br> This formulation is useful, because now we don't need to name intermediates, we can just chain functions.
<br><bt>

<h2>From pattern matching to continuation-passing style</h2>
There are several drawbacks to the monadic approach. First, compared to pattern matching, it reports problems at the end and in reverse order, which is not intuitive.
Second, it still needs indentation that will increase if we add conversions, which we did not need in the JavaScript imperative version.
<br><br>
Fortunately, there is another way to express the initial chain to catch early errors, using the <code>maybe</code> operator:
<div language="haskell" code="maybe :: c -> (a -> c) -> Maybe a -> c&#10;maybe onNothing onJust value =&#10;  case value of&#10;    Nothing ->&#10;      onNothing&#10;    &#10;    Just x ->&#10;      onJust x&#10;" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div>

Using <code>maybe</code>, let's start over from pattern matching and express <code>convertData</code> in another way:
<div class="step"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  case convert input of&#10;    Nothing ->&#10;      Left &quot;problem 1&quot;&#10;&#10;    Just intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      case convert3 intermediate2 of&#10;        Nothing -> Left &quot;problem 2&quot;&#10;        Just intermediate3 ->&#10;          Right intermediate3" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> maybe (Left &quot;problem 1&quot;) (\intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      case convert3 intermediate2 of&#10;        Nothing -> Left &quot;problem 2&quot;&#10;        Just intermediate3 ->&#10;          Right intermediate3&#10;     )" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> maybe (Left &quot;problem 1&quot;) (\intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      convert3 intermediate2&#10;      |> maybe (Left &quot;problem 2&quot;) (\intermediate3 ->&#10;          Right intermediate3&#10;      )&#10;     )" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> maybe (Left &quot;problem 1&quot;) (\intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      convert3 intermediate2&#10;      |> maybe (Left &quot;problem 2&quot;) Right&#10;     )" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>

It might seem that we cannot refactor further. Fortunately, we can define <code>with</code> that transforms function application to callback style:
<div language="haskell" code="with :: (a -> b) -> (b -> c) -> a -> c&#10;with function callback value =&#10;       callback (function value)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div>
so that now we can continue the transformation:
<div class="step second"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  convert input&#10;  |> maybe (Left &quot;problem 1&quot;) (\intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      convert3 intermediate2&#10;      |> maybe (Left &quot;problem 2&quot;) Right&#10;    )" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  with convert &#10;    (maybe (Left &quot;problem 1&quot;) (\intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      convert3 intermediate2&#10;      |> maybe (Left &quot;problem 2&quot;) Right&#10;    )) input" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;    (maybe (Left &quot;problem 1&quot;) (\intermediate ->&#10;      let intermediate2 = convert2 intermediate in&#10;      convert3 intermediate2&#10;      |> maybe (Left &quot;problem 2&quot;) Right&#10;    ))" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;    (maybe (Left &quot;problem 1&quot;) (\intermediate ->&#10;      with convert2 (\intermediate2 ->&#10;      convert3 intermediate2&#10;      |> maybe (Left &quot;problem 2&quot;) Right&#10;      ) intermediate&#10;    ))" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;    (maybe (Left &quot;problem 1&quot;) (&#10;      with convert2 (\intermediate2 ->&#10;      convert3 intermediate2&#10;      |> maybe (Left &quot;problem 2&quot;) Right&#10;    )))" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;    (maybe (Left &quot;problem 1&quot;) (&#10;      with convert2 (\intermediate2 ->&#10;      with convert3 &#10;        (maybe (Left &quot;problem 2&quot;) Right)&#10;        intermediate2&#10;    )))" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;    (maybe (Left &quot;problem 1&quot;) (&#10;      with convert2 (&#10;      with convert3 &#10;        (maybe (Left &quot;problem 2&quot;) Right)&#10;    )))" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;  $  maybe (Left &quot;problem 1&quot;) (&#10;      with convert2 (&#10;      with convert3 &#10;        (maybe (Left &quot;problem 2&quot;) Right)&#10;    ))" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $   with convert2 (&#10;      with convert3 &#10;        (maybe (Left &quot;problem 2&quot;) Right)&#10;    )" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $   with convert2&#10;  $   with convert3 &#10;        (maybe (Left &quot;problem 2&quot;) Right)" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;  with convert &#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $   with convert2&#10;  $   with convert3 &#10;  $     maybe (Left &quot;problem 2&quot;) Right" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;    with convert &#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  with convert2&#10;  $  with convert3 &#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  Right" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>

The operator <code>$ </code> passes the expression at its right (in our case, always a callback) as the last argument of the expression to its left.<br> In general, callbacks have also the advantage of being immediately compatible with asynchronous computations.<br>
Moreover, what if <code>convertData</code> also accepted a callback as the first argument? Then we would be able to express it concisely as well.

<div class="step second"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convertData :: a -> Either String d&#10;convertData =&#10;    with convert &#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  with convert2&#10;  $  with convert3 &#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  Right" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: a -> Either String d&#10;convertData input =&#10;  ( with convert &#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  with convert2&#10;  $  with convert3 &#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  Right ) input" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback input =&#10;  ( with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  with convert2&#10;  $  with convert3&#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  with Right&#10;  $  callback) input" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback =&#10;    with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  with convert2&#10;  $  with convert3&#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  with Right&#10;  $  callback" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData =&#10;    with convert&#10;  .  maybe (Left &quot;problem 1&quot;)&#10;  .  with convert2&#10;  .  with convert3&#10;  .  maybe (Left &quot;problem 2&quot;)&#10;  .  with Right" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>
The operator <code>. </code> composes functions naturally, meaning <code>(f .  g) x</code> = <code>f (g x)</code>.<br><br>
At this point, it's normal to pause and marvel a bit. We use the operator <code>. </code> which is normally used to chain functions from right to left, that is,<br><code>(f .  g) x</code> = <code>f (g x)</code>. In our case, because they are callbacks, the chaining makes the callbacks to be executed left to right, because <br><code>(f .  g) callback x</code> = <br><code>(f $  g callback) x</code> = <br><code>f (g callback) x</code> = <br><code>f (\y -> g callback y) x</code><br>which guarantees that g is executed with the result of f, not the other way round.

<h2 id="non-linear-workflows">Non-linear workflows</h2>

The previous style is great, but what if we need to refer to some of the intermediate results to parametrize a further computation?
Although named disappeared, it's possible to reintroduce them.<br>
Suppose that the new signature for <code>convert3</code> is the following:
<div class="step second"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convert :: a -> Maybe b&#10;convert2 :: b -> c&#10;convert3 :: c -> Maybe d" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convert :: a -> Maybe b&#10;convert2 :: b -> c&#10;convert3 :: b -> c -> Maybe d" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>

Because of the callback-style workflow, it would be natural to write:
<div class="step second"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback =&#10;     with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;&#10;  $  with convert2&#10;  $  with convert3&#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  with Right&#10;  $  callback" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback =&#10;     with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  \b ->&#10;  (  with convert2&#10;  $  with (convert3 b)&#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  with Right&#10;  $  callback) b" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>
However, it is hard to see how to reduce that further, and remove the <code>b</code> after parentheses.
Looking closely, we see that the callback is in any case applying <code>b</code> to some function.
This means we can give a name to this construct.
Let us introduce the <code>nameIt</code> operator that builds a callback by applying the value twice to it:
<div language="haskell" code="nameIt :: (a -> a -> b) -> a -> b&#10;nameIt nameToCallback value =&#10;  (nameToCallback value) value" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div>
Now, the workflow can be rewritten:
<div class="step second"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback =&#10;     with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  \b ->&#10;  (  with convert2&#10;  $  with (convert3 b)&#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  with Right&#10;  $  callback) b" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback =&#10;     with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  nameIt <| \b ->&#10;     with convert2&#10;  $  with (convert3 b)&#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  with Right&#10;  $  callback" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>
To fully get rid of the <code>callback</code> argument, we would have to make <code>nameIt</code> accept it as second argument:
<div language="haskell" code="withName :: (a -> a -> b) -> (b -> e) -> a -> e&#10;withName nameToCallback callback value =&#10;  (nameToCallback value callback) value" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div>
Thus the final function becomes:
<div class="step second"><button class="previous" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.previousElementSibling &amp;&amp; q.previousElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.previousElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">&lt;Previous</button>—<button class="next" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; q.nextElementSibling &amp;&amp; q.nextElementSibling.matches(&quot;div[code]&quot;)) {&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  q.nextElementSibling.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;  step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Next></button><button class="final" onclick="&#10;var step = this.parentNode;&#10;&#10;var q = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;if(q.length == 0) {&#10;  var whichone = step.matches(&quot;.second&quot;) ? 1 : 0;&#10;  q = step.querySelectorAll(&quot;div[code]&quot;);&#10;  for(var i = 0; i < q.length; i++) {&#10;    q[i].setAttribute(&quot;ghost-active&quot;, i == whichone ? &quot;true&quot; : &quot;false&quot;);&#10;  }&#10;};&#10;var qs = step.querySelectorAll(&quot;div[code][ghost-active]&quot;);&#10;var q = step.querySelector(&quot;div[code][ghost-active=true]&quot;);&#10;if(q &amp;&amp; qs.length > 0 &amp;&amp; qs[qs.length - 1].matches(&quot;div[code][ghost-active=false]&quot;)) {&#10;  var last = qs[qs.length - 1];&#10;  q.setAttribute(&quot;ghost-active&quot;, &quot;false&quot;);&#10;  last.setAttribute(&quot;ghost-active&quot;, &quot;true&quot;);&#10;}&#10;&#10;var first = step.querySelector(&quot;div[code]&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.previous&quot;).setAttribute(&quot;ghost-active&quot;, first ? &quot;false&quot; : &quot;true&quot;);&#10;&#10;var final = step.querySelector(&quot;div[code]:last-of-type&quot;).getAttribute(&quot;ghost-active&quot;) == &quot;true&quot;;&#10;step.querySelector(&quot;button.next&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;step.querySelector(&quot;button.final&quot;).setAttribute(&quot;ghost-active&quot;, final ? &quot;false&quot; : &quot;true&quot;);&#10;">Last>></button><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback =&#10;     with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  nameIt <| \b ->&#10;     with convert2&#10;  $  with (convert3 b)&#10;  $  maybe (Left &quot;problem 2&quot;)&#10;  $  with Right&#10;  $  callback" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData callback =&#10;     with convert&#10;  $  maybe (Left &quot;problem 1&quot;)&#10;  $  withName (\b ->&#10;     with convert2&#10;  .  with (convert3 b)&#10;  .  maybe (Left &quot;problem 2&quot;)&#10;  .  with Right )&#10;  $  callback" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><div language="haskell" code="convertData :: (Either String d -> e) -> a -> e&#10;convertData =&#10;    with convert&#10;  .  maybe (Left &quot;problem 1&quot;)&#10;  .  withName (\b ->&#10;     with convert2&#10;  .  with (convert3 b)&#10;  .  maybe (Left &quot;problem 2&quot;)&#10;  .  with Right )" list-ghost-attributes="class draggable style" children-are-ghosts="true" save-ghost-attributes="style"></div><script>
var step = document.currentScript.parentElement;

var q = step.querySelectorAll("div[code][ghost-active]");
if(q.length == 0) {
  var whichone = step.matches(".second") ? 1 : 0;
  q = step.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    q[i].setAttribute("ghost-active", i == whichone ? "true" : "false");
  }
}

var first = step.querySelector("div[code]").getAttribute("ghost-active") == "true";
step.querySelector("button.previous").setAttribute("ghost-active", first ? "false" : "true");

var final = step.querySelector("div[code]:last-of-type").getAttribute("ghost-active") == "true";
step.querySelector("button.next").setAttribute("ghost-active", final ? "false" : "true");
step.querySelector("button.final").setAttribute("ghost-active", final ? "false" : "true");
</script></div>

Because .  has higher precedence over $ , we cannot remove the final parentheses.
So choosing the earlier "$ " version vs. the ". " version just above is a matter of taste.

<h2>Epilogue: Towards Church encoding</h2>
It is surprising that, using default operators such as <code>. </code>, we obtain a code as concise as the imperative style, with error catching in the correct order.<br><br>
In his minimalistic functional language where only functions are values, Church <a href="https://en.wikipedia.org/wiki/Church_encoding">naturally encodes</a> datatypes <code>Maybe</code> and <code>Either</code> as continuation passing style.<br>


Therefore, a <code>Just x</code> becomes a <code>(\onNothing onJust -> onJust x)</code>, whereas a <code>Nothing</code> becomes a <code>(\onNothing onJust -> onNothing)</code>.<br>

Continuation-passing style is therefore not something new, but the ancestral way of writing functional code.<br><br>

The inspiration of this article came from the build file itself I used to build this blog (<a href="https://github.com/MikaelMayer/MikaelMayer.github.io/blob/master/blog/hydefile.elm#L41">here</a> and <a href="https://github.com/MikaelMayer/MikaelMayer.github.io/blob/master/blog/hydefile.elm#L68">here</a>).
</bt></div>
<script>
(typeof setGhostOnInserted != "undefined" ? setGhostOnInserted : []).push(insertedNode => insertedNode.tagName == "SCRIPT" && insertedNode.getAttribute("src") && insertedNode.getAttribute("src").startsWith("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/mode-"));
var script = document.createElement('script');
script.src = 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/ace.js';
script.async = false;
script.setAttribute("isghost", "true");
document.head.appendChild(script);
script = document.createElement('script');
script.innerText = `
  var q = document.querySelectorAll("div[code]");
  for(var i = 0; i < q.length; i++) {
    var language = q[i].getAttribute("language") || "javascript";
    var aceeditor = ace.edit(q[i], {
      mode: "ace/mode/" + language,
      maxLines: 30
    });
    aceeditor.setValue(q[i].getAttribute("code"));
    aceeditor.selection.clearSelection();
    aceeditor.setOption("highlightActiveLine", false);
    aceeditor.setOption("readOnly", true);
    aceeditor.on("change", ((qi, aceeditor) => (e) => {
      qi.setAttribute("code", aceeditor.getValue());
      })(q[i], aceeditor))
  }`;
script.async = false;
script.setAttribute("isghost", "true");
onAceLoaded = (delay) => () => {
  if(typeof ace != "undefined") {
    console.log("ace loaded.")
    document.head.appendChild(script)
  } else {
    console.log("ace not loaded. Retrying in " + (delay * 2) + "ms");
    setTimeout(onAceLoaded(delay * 2), 100);
  }
}
onAceLoaded(1)();
</script>
</body></html>