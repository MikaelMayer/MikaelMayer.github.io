<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Reflex4You formula view." />
  <link rel="manifest" href="./manifest.json" />
  <script src="./orientation-lock.js"></script>
  <script src="./wake-lock.js"></script>
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <title>Reflex4You â€“ Formula</title>
  <!-- MathJax v3 (SVG output) -->
  <script>
    window.MathJax = {
      startup: { typeset: false },
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'none' }, // self-contained-ish SVGs; nicer for copying/export
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <style>
    :root {
      color-scheme: dark;
      --bg0: #06070a;
      --bg1: #0b1020;
      --panel: rgba(10, 12, 18, 0.72);
      --panel-border: rgba(255, 255, 255, 0.10);
      --text: rgba(255, 255, 255, 0.90);
      --muted: rgba(255, 255, 255, 0.62);
      --accent: #7dd3fc;
      --danger: #ffb4b4;
    }

    html, body {
      margin: 0;
      min-height: 100%;
      background: radial-gradient(1200px 900px at 15% 10%, #162044 0%, var(--bg0) 55%, #020308 100%);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
    }

    mjx-assistive-mml {
      display: none !important;
    }

    a {
      color: inherit;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    .page {
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 16px 40px;
      box-sizing: border-box;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .brand {
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--panel-border);
      background: rgba(0, 0, 0, 0.22);
      color: var(--muted);
      font-size: 13px;
      line-height: 1;
    }
    .chip strong {
      color: var(--text);
      font-weight: 600;
    }

    #menu-anchor {
      position: relative;
      display: inline-flex;
      align-items: center;
    }

    #menu-button {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid var(--panel-border);
      background: rgba(0, 0, 0, 0.28);
      color: var(--text);
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      cursor: pointer;
      padding: 0;
    }

    #menu-button:hover,
    #menu-button:focus-visible {
      border-color: rgba(255, 255, 255, 0.35);
      background: rgba(0, 0, 0, 0.45);
      outline: none;
    }

    #menu-button span {
      width: 18px;
      height: 2px;
      border-radius: 2px;
      background: currentColor;
      display: block;
    }

    #menu-dropdown {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background: rgba(0, 0, 0, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.28);
      border-radius: 12px;
      min-width: 200px;
      padding: 6px 0;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      gap: 2px;
      opacity: 0;
      transform: translateY(-6px);
      pointer-events: none;
      visibility: hidden;
      transition: opacity 0.12s ease, transform 0.12s ease;
      z-index: 5;
    }

    #menu-dropdown.menu-dropdown--open {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      visibility: visible;
    }

    .menu-dropdown__item {
      background: transparent;
      border: 0;
      color: rgba(255, 255, 255, 0.92);
      font-size: 13px;
      padding: 10px 16px;
      text-align: left;
      cursor: pointer;
      width: 100%;
      font-family: inherit;
    }

    .menu-dropdown__item:hover,
    .menu-dropdown__item:focus-visible {
      background: rgba(255, 255, 255, 0.08);
      outline: none;
    }

    .card {
      border: 1px solid var(--panel-border);
      background: var(--panel);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
    }

    .card__header {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      gap: 12px;
      align-items: baseline;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .card__header h1 {
      margin: 0;
      font-size: 16px;
      font-weight: 650;
      letter-spacing: 0.01em;
    }

    .card__body {
      padding: 18px 16px 16px;
    }

    .editor {
      margin: 0 0 12px;
    }

    .editor__label {
      margin: 0 0 6px;
      font-size: 12px;
      letter-spacing: 0.02em;
      color: var(--muted);
    }

    .editor__input {
      width: 100%;
      box-sizing: border-box;
      resize: vertical;
      min-height: 3.6em;
      max-height: 40vh;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(0, 0, 0, 0.22);
      color: rgba(255, 255, 255, 0.92);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 14px;
      line-height: 1.35;
      outline: none;
    }

    .editor__input:focus-visible {
      border-color: rgba(125, 211, 252, 0.55);
      box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.12);
    }

    .error {
      display: none;
      margin: 0 0 12px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 180, 180, 0.35);
      background: rgba(35, 0, 0, 0.55);
      color: var(--danger);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      white-space: pre;
      overflow: auto;
      max-height: 42vh;
    }

    .error[data-error-kind="parse"] {
      cursor: pointer;
    }

    .formula {
      padding: 0;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(0, 0, 0, 0.28);
      overflow: hidden;
      color: rgba(255, 255, 255, 0.92);
    }

    .formula-canvas {
      display: block;
      width: 100%;
      height: 220px;
    }

    .block-label {
      margin: 0 0 6px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.02em;
    }

    .btn {
      appearance: none;
      border: 1px solid rgba(255, 255, 255, 0.16);
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.28);
      color: rgba(255, 255, 255, 0.9);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 8px 10px;
      cursor: pointer;
    }

    .btn:hover,
    .btn:focus-visible {
      border-color: rgba(255, 255, 255, 0.32);
      outline: none;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin: 10px 0 12px;
    }
    .controls__field {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .controls__label {
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.02em;
    }
    .controls__input {
      width: 120px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(0, 0, 0, 0.22);
      color: rgba(255, 255, 255, 0.92);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      outline: none;
    }
    .controls__input:focus-visible {
      border-color: rgba(125, 211, 252, 0.55);
      box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.12);
    }
    .preset {
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(0, 0, 0, 0.18);
      color: rgba(255, 255, 255, 0.86);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      cursor: pointer;
      line-height: 1;
    }
    .preset:hover,
    .preset:focus-visible {
      border-color: rgba(255, 255, 255, 0.32);
      outline: none;
    }

    .controls__toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
    }
    .controls__checkbox {
      margin: 0;
    }

    /* Canvas is responsive; JS sizes the backing store to match. */
  </style>
</head>
<body>
  <div class="page">
    <div class="topbar">
      <div class="brand">Reflex4You</div>
      <div id="menu-anchor">
        <button
          id="menu-button"
          type="button"
          aria-label="Open menu"
          aria-haspopup="menu"
          aria-expanded="false"
          aria-controls="menu-dropdown"
        >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </button>
        <div id="menu-dropdown" role="menu" aria-hidden="true">
          <button
            type="button"
            class="menu-dropdown__item"
            data-menu-action="visualize-formula"
            role="menuitem"
          >
            Visualize formula
          </button>
          <button
            type="button"
            class="menu-dropdown__item"
            data-menu-action="back-to-viewer"
            role="menuitem"
          >
            Back to viewer
          </button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card__body">
        <div class="editor">
          <p class="editor__label">Formula</p>
          <textarea id="formula-input" class="editor__input" spellcheck="false" aria-label="Formula"></textarea>
        </div>
        <pre id="formula-error" class="error" aria-live="polite"></pre>
        <p class="block-label">Preview (Canvas)</p>
        <div class="controls">
          <div class="controls__field">
            <span class="controls__label">Canvas background</span>
            <button class="preset" type="button" data-bghex="ffffff80" data-fghex="000000ff">white50</button>
            <button class="preset" type="button" data-bghex="00000080" data-fghex="ffffffff">black50</button>
            <span class="controls__label">custom</span>
            <input id="bghex" class="controls__input" type="text" value="ffffff80" spellcheck="false" inputmode="text" aria-label="Custom canvas background in RRGGBBAA hex" />
          </div>
          <div class="controls__field">
            <label class="controls__toggle" for="inline-fingers">
              <input id="inline-fingers" class="controls__checkbox" type="checkbox" />
              Inline finger constants
            </label>
          </div>
          <button id="download-png" class="btn" type="button" disabled>Download PNG</button>
        </div>
        <div class="formula" aria-label="Rendered formula">
          <canvas id="formula-render" class="formula-canvas"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Cache-bust module import in PR previews (HTML updates sooner than JS sometimes).
    const HTML_BUILD_ID = 'pr154-79f49bdc0bd2f9256d4ac162c4b40fd47e30d22f';
    window.__reflexHtmlBuildId = HTML_BUILD_ID;
    import(`./formula-page.mjs?build=${encodeURIComponent(HTML_BUILD_ID)}`);
  </script>
</body>
</html>

